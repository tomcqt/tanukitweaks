{"version":3,"sources":["webpack:///./app/javascript/mastodon/components/admin/ReportReasonSelector.jsx"],"names":["messages","defineMessages","legal","id","defaultMessage","other","spam","violation","Category","PureComponent","constructor","arguments","handleClick","disabled","onSelect","this","props","render","text","selected","children","_jsx","tabIndex","role","className","classNames","onClick","type","name","value","active","Rule","onToggle","checkbox","ReportReasonSelector","state","category","rule_ids","rules","_save","api","put","catch","err","console","error","handleSelect","setState","handleToggle","includes","filter","x","componentDidMount","get","then","res","data","intl","formatMessage","map","rule","injectIntl"],"mappings":"2JASA,MAAMA,EAAWC,YAAe,CAC9BC,MAAO,CAAEC,GAAG,0BAA4BC,eAAe,SACvDC,MAAO,CAAEF,GAAG,0BAA4BC,eAAe,SACvDE,KAAM,CAAEH,GAAG,yBAA2BC,eAAe,QACrDG,UAAW,CAAEJ,GAAG,8BAAgCC,eAAe,+CAGjE,MAAMI,UAAiBC,gBAAcC,cAAA,SAAAC,WAAA,KAWnCC,YAAc,KACZ,MAAM,GAAET,EAAE,SAAEU,EAAQ,SAAEC,GAAaC,KAAKC,MAEnCH,GACHC,EAASX,EACX,CACA,CAEFc,SACE,MAAM,GAAEd,EAAE,KAAEe,EAAI,SAAEL,EAAQ,SAAEM,EAAQ,SAAEC,GAAaL,KAAKC,MAExD,OACEK,YAAA,OAAKC,SAAU,EAAGC,KAAK,SAASC,UAAWC,IAAW,mCAAoC,CAAEN,WAAUN,aAAaa,QAASX,KAAKH,kBAAY,EAC1IO,GAAYE,YAAA,SAAOM,KAAK,SAASC,KAAK,mBAAmBC,MAAO1B,IAEjEkB,YAAA,OAAKG,UAAU,gDAAyC,EACtDH,YAAA,QAAMG,UAAWC,IAAW,cAAe,CAAEK,OAAQX,EAAUN,eAC9DK,GAGDC,GAAYC,GACZC,YAAA,OAAKG,UAAU,gDAAyC,EACrDJ,GAKX,EAIF,MAAMW,UAAatB,gBAAcC,cAAA,SAAAC,WAAA,KAU/BC,YAAc,KACZ,MAAM,GAAET,EAAE,SAAEU,EAAQ,SAAEmB,GAAajB,KAAKC,MAEnCH,GACHmB,EAAS7B,EACX,CACA,CAEFc,SACE,MAAM,GAAEd,EAAE,KAAEe,EAAI,SAAEL,EAAQ,SAAEM,GAAaJ,KAAKC,MAE9C,OACEK,YAAA,OAAKC,SAAU,EAAGC,KAAK,SAASC,UAAWC,IAAW,+BAAgC,CAAEN,WAAUN,aAAaa,QAASX,KAAKH,kBAAY,EACvIS,YAAA,QAAMG,UAAWC,IAAW,cAAe,CAAEQ,UAAU,EAAMH,OAAQX,EAAUN,eAC9EM,GAAYE,YAAA,SAAOM,KAAK,SAASC,KAAK,qBAAqBC,MAAO1B,IAClEe,EAGP,EAIF,MAAMgB,UAA6BzB,gBAAcC,cAAA,SAAAC,WAAA,KAU/CwB,MAAQ,CACNC,SAAUrB,KAAKC,MAAMoB,SACrBC,SAAUtB,KAAKC,MAAMqB,UAAY,GACjCC,MAAO,IACP,KAYFC,MAAQ,KACN,MAAM,GAAEpC,EAAE,SAAEU,GAAaE,KAAKC,OACxB,SAAEoB,EAAQ,SAAEC,GAAatB,KAAKoB,MAEhCtB,GAIJ2B,cAAMC,IAAK,yBAAwBtC,IAAM,CACvCiC,WACAC,aACCK,OAAMC,IACPC,QAAQC,MAAMF,EAAI,GAClB,EACF,KAEFG,aAAe3C,IACbY,KAAKgC,SAAS,CAAEX,SAAUjC,IAAM,IAAMY,KAAKwB,SAAQ,EACnD,KAEFS,aAAe7C,IACb,MAAM,SAAEkC,GAAatB,KAAKoB,MAEtBE,EAASY,SAAS9C,GACpBY,KAAKgC,SAAS,CAAEV,SAAUA,EAASa,QAAOC,GAAKA,IAAMhD,MAAQ,IAAMY,KAAKwB,UAExExB,KAAKgC,SAAS,CAAEV,SAAU,IAAIA,EAAUlC,KAAO,IAAMY,KAAKwB,SAC5D,CACA,CAtCFa,oBACEZ,cAAMa,IAAI,oBAAoBC,MAAKC,IACjCxC,KAAKgC,SAAS,CACZT,MAAOiB,EAAIC,KAAKlB,OAChB,IACDI,OAAMC,IACPC,QAAQC,MAAMF,EAAI,GAEtB,CAgCA1B,SACE,MAAM,SAAEJ,EAAQ,KAAE4C,GAAS1C,KAAKC,OAC1B,MAAEsB,EAAK,SAAEF,EAAQ,SAAEC,GAAatB,KAAKoB,MAE3C,OACEd,YAAA,OAAKG,UAAU,+BAAwB,EACrCH,YAACb,EAAQ,CAACL,GAAG,QAAQe,KAAMuC,EAAKC,cAAc1D,EAASK,OAAQc,SAAuB,UAAbiB,EAAsBtB,SAAUC,KAAK+B,aAAcjC,SAAUA,IACtIQ,YAACb,EAAQ,CAACL,GAAG,QAAQe,KAAMuC,EAAKC,cAAc1D,EAASE,OAAQiB,SAAuB,UAAbiB,EAAsBtB,SAAUC,KAAK+B,aAAcjC,SAAUA,IACtIQ,YAACb,EAAQ,CAACL,GAAG,OAAOe,KAAMuC,EAAKC,cAAc1D,EAASM,MAAOa,SAAuB,SAAbiB,EAAqBtB,SAAUC,KAAK+B,aAAcjC,SAAUA,IACnIQ,YAACb,EAAQ,CAACL,GAAG,YAAYe,KAAMuC,EAAKC,cAAc1D,EAASO,WAAYY,SAAuB,cAAbiB,EAA0BtB,SAAUC,KAAK+B,aAAcjC,SAAUA,QAAS,EACxJyB,EAAMqB,KAAIC,GAAQvC,YAACU,EAAI,CAAe5B,GAAIyD,EAAKzD,GAAIe,KAAM0C,EAAK1C,KAAMC,SAAUkB,EAASY,SAASW,EAAKzD,IAAK6B,SAAUjB,KAAKiC,aAAcnC,SAAUA,GAApH+C,EAAKzD,OAI3C,EAIa0D,sBAAW3B,E","file":"js/434-cc2f688dd0c8e4c76014.chunk.js","sourcesContent":["import PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\n\nimport { injectIntl, defineMessages } from 'react-intl';\n\nimport classNames from 'classnames';\n\nimport api from 'mastodon/api';\n\nconst messages = defineMessages({\n  legal: { id: 'report.categories.legal', defaultMessage: 'Legal' },\n  other: { id: 'report.categories.other', defaultMessage: 'Other' },\n  spam: { id: 'report.categories.spam', defaultMessage: 'Spam' },\n  violation: { id: 'report.categories.violation', defaultMessage: 'Content violates one or more server rules' },\n});\n\nclass Category extends PureComponent {\n\n  static propTypes = {\n    id: PropTypes.string.isRequired,\n    text: PropTypes.string.isRequired,\n    selected: PropTypes.bool,\n    disabled: PropTypes.bool,\n    onSelect: PropTypes.func,\n    children: PropTypes.node,\n  };\n\n  handleClick = () => {\n    const { id, disabled, onSelect } = this.props;\n\n    if (!disabled) {\n      onSelect(id);\n    }\n  };\n\n  render () {\n    const { id, text, disabled, selected, children } = this.props;\n\n    return (\n      <div tabIndex={0} role='button' className={classNames('report-reason-selector__category', { selected, disabled })} onClick={this.handleClick}>\n        {selected && <input type='hidden' name='report[category]' value={id} />}\n\n        <div className='report-reason-selector__category__label'>\n          <span className={classNames('poll__input', { active: selected, disabled })} />\n          {text}\n        </div>\n\n        {(selected && children) && (\n          <div className='report-reason-selector__category__rules'>\n            {children}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n}\n\nclass Rule extends PureComponent {\n\n  static propTypes = {\n    id: PropTypes.string.isRequired,\n    text: PropTypes.string.isRequired,\n    selected: PropTypes.bool,\n    disabled: PropTypes.bool,\n    onToggle: PropTypes.func,\n  };\n\n  handleClick = () => {\n    const { id, disabled, onToggle } = this.props;\n\n    if (!disabled) {\n      onToggle(id);\n    }\n  };\n\n  render () {\n    const { id, text, disabled, selected } = this.props;\n\n    return (\n      <div tabIndex={0} role='button' className={classNames('report-reason-selector__rule', { selected, disabled })} onClick={this.handleClick}>\n        <span className={classNames('poll__input', { checkbox: true, active: selected, disabled })} />\n        {selected && <input type='hidden' name='report[rule_ids][]' value={id} />}\n        {text}\n      </div>\n    );\n  }\n\n}\n\nclass ReportReasonSelector extends PureComponent {\n\n  static propTypes = {\n    id: PropTypes.string.isRequired,\n    category: PropTypes.string.isRequired,\n    rule_ids: PropTypes.arrayOf(PropTypes.string),\n    disabled: PropTypes.bool,\n    intl: PropTypes.object.isRequired,\n  };\n\n  state = {\n    category: this.props.category,\n    rule_ids: this.props.rule_ids || [],\n    rules: [],\n  };\n\n  componentDidMount() {\n    api().get('/api/v1/instance').then(res => {\n      this.setState({\n        rules: res.data.rules,\n      });\n    }).catch(err => {\n      console.error(err);\n    });\n  }\n\n  _save = () => {\n    const { id, disabled } = this.props;\n    const { category, rule_ids } = this.state;\n\n    if (disabled) {\n      return;\n    }\n\n    api().put(`/api/v1/admin/reports/${id}`, {\n      category,\n      rule_ids,\n    }).catch(err => {\n      console.error(err);\n    });\n  };\n\n  handleSelect = id => {\n    this.setState({ category: id }, () => this._save());\n  };\n\n  handleToggle = id => {\n    const { rule_ids } = this.state;\n\n    if (rule_ids.includes(id)) {\n      this.setState({ rule_ids: rule_ids.filter(x => x !== id ) }, () => this._save());\n    } else {\n      this.setState({ rule_ids: [...rule_ids, id] }, () => this._save());\n    }\n  };\n\n  render () {\n    const { disabled, intl } = this.props;\n    const { rules, category, rule_ids } = this.state;\n\n    return (\n      <div className='report-reason-selector'>\n        <Category id='other' text={intl.formatMessage(messages.other)} selected={category === 'other'} onSelect={this.handleSelect} disabled={disabled} />\n        <Category id='legal' text={intl.formatMessage(messages.legal)} selected={category === 'legal'} onSelect={this.handleSelect} disabled={disabled} />\n        <Category id='spam' text={intl.formatMessage(messages.spam)} selected={category === 'spam'} onSelect={this.handleSelect} disabled={disabled} />\n        <Category id='violation' text={intl.formatMessage(messages.violation)} selected={category === 'violation'} onSelect={this.handleSelect} disabled={disabled}>\n          {rules.map(rule => <Rule key={rule.id} id={rule.id} text={rule.text} selected={rule_ids.includes(rule.id)} onToggle={this.handleToggle} disabled={disabled} />)}\n        </Category>\n      </div>\n    );\n  }\n\n}\n\nexport default injectIntl(ReportReasonSelector);\n"],"sourceRoot":""}